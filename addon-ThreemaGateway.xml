<?xml version="1.0" encoding="utf-8"?>
<addon addon_id="ThreemaGateway" title="Threema Gateway (2FA)" version_string="0.2.0" version_id="2" url="" install_callback_class="ThreemaGateway_Installer" install_callback_method="install" uninstall_callback_class="ThreemaGateway_Installer" uninstall_callback_method="uninstall">
  <admin_navigation/>
  <admin_permissions>
    <admin_permission admin_permission_id="threemagw_showcredits" display_order="620"/>
  </admin_permissions>
  <admin_style_properties/>
  <admin_templates>
    <template title="threemagateway_option_list_option_hidden"><![CDATA[<xen:require css="threemagateway_option_list_option_hidden.css" />

<xen:controlunit label="" class="threemagateway_option_hidden">
	<xen:include template="option_list_option_uneditable" />
</xen:controlunit>]]></template>
    <template title="threemagateway_option_list_option_hidden.css"><![CDATA[.threemagateway_option_hidden {
  display: none;
}]]></template>
    <template title="threemagw_option_list_receivecallback"><![CDATA[<xen:require css="threemagw_option_list_receivecallback.css" />
<xen:require js="js/ThreemaGateway/options.js" />

<xen:controlunit label="{$preparedOption.title}" hint="{$preparedOption.hint}">
	<xen:explain>{xen:raw $preparedOption.explain}</xen:explain>
	<xen:html>
		<div class="threemagw_receivecallback_container">
			<span class="threemagw_receivecallback_nonedit">
				{xen:raw $formatParams.basetext}<span contentEditable="true" class="threemagw_receivecallback_input">{$preparedOption.option_value}</span><span class="threemagw_receivecallback_fakecharacter">&nbsp;</span>
			</span>
		</div>
		<input id="{$fieldPrefix}{$preparedOption.option_id}" class="threemagw_receivecallback_hiddeninput" type="hidden" name="{$fieldPrefix}[{$preparedOption.option_id}]" value="{$preparedOption.option_value}" />
				
		<xen:include template="option_list_option_editlink" />
		<input type="hidden" name="{$listedFieldName}" value="{$preparedOption.option_id}" />
		{xen:raw $editLink}
	</xen:html>
</xen:controlunit>]]></template>
    <template title="threemagw_option_list_receivecallback.css"><![CDATA[.threemagw_receivecallback_container {
  word-break: break-all;
}

.threemagw_receivecallback_nonedit {
  
}

.threemagw_receivecallback_input{
  margin-left: -1px;
  border: 1px dashed;
  border-color: rgba(255, 255, 255, 0);
}

.threemagw_receivecallback_input:hover,
.threemagw_receivecallback_input:active,
.threemagw_receivecallback_input:focus{
  color: {xen:property primaryDarker};
  background-color: {xen:property textCtrlBackground};
  border-color: {xen:property primaryDarker};
}

.threemagw_receivecallback_input:focus{
  background-color: {xen:property inlineMod};
}


/* This space gets hidden and is a hack to make the string better selectable */
.threemagw_receivecallback_fakecharacter {
  opacity: 0;
}]]></template>
    <template title="threemagw_option_list_status"><![CDATA[<xen:require css="threemagw_option_list_status.css" />

<xen:controlunit label="{$preparedOption.title}" hint="{$preparedOption.hint}">
	<xen:explain>{xen:raw $preparedOption.explain}</xen:explain>
	<xen:html>
		<p>{xen:raw $status.libsodium.text} <span class="explain addnote">{xen:raw $status.libsodium.addition}</span></p>
		<p class="explain {$status.libsodium.descclass}">{xen:raw $status.libsodium.descr}</p>

		<p>{xen:raw $status.libsodiumphp.text} <span class="explain addnote">{xen:raw $status.libsodiumphp.addition}</span></p>
		<p class="explain {$status.libsodiumphp.descclass}">{xen:raw $status.libsodiumphp.descr}</p>

		<p>{xen:raw $status.phpsdk.text} <span class="explain addnote">{xen:raw $status.phpsdk.addition}</span></p>
		<p class="explain {$status.phpsdk.descclass}">{xen:raw $status.phpsdk.descr}</p>

		<p>{xen:raw $status.credits.text} <span class="explain addnote">{xen:raw $status.credits.addition}</span></p>
		<p class="explain {$status.credits.descclass}">{xen:raw $status.credits.descr}</p>

		<xen:if is="{$additionalerror}">
			<xen:foreach loop="$additionalerror" value="$error" i="$i">
				<br />
				<p class="<xen:if is="{$error.descclass}">{$error.descclass}<xen:else />error</xen:if>">{xen:raw $error.text}<span class="explain addnote">{xen:raw $error.addition}</span></p>
			</xen:foreach>
		</xen:if>

		<xen:if is="{$isConfError}">
			<br />
			<p class="error">{xen:phrase option_threema_gateway_status_error}</p>
		</xen:if>

		<input type="hidden" name="{$listedFieldName}" value="{$preparedOption.option_id}" />
		{xen:raw $editLink}
	</xen:html>
</xen:controlunit>]]></template>
    <template title="threemagw_option_list_status.css"><![CDATA[.warning {
  color: rgb(195, 123, 0) !important;
}

.error {
  color: rgb(195, 0, 0) !important;
}

.addnote {
}]]></template>
    <template title="two_step_threemagw_conventional"><![CDATA[<p>{xen:phrase tfa_threemagw_conventional_message_has_been_send_to_x_with_code_login, 'threemaid={$data.threemaid}'}</p>

<dl class="ctrlUnit">
    <dt><label for="ctrl_threemagw_code">{xen:phrase threemagw_confirmation_code}:</label></dt>
	<dd>
        <input type="text" name="code" id="ctrl_threemagw_code" class="textCtrl" />
	</dd>
</dl>]]></template>
  </admin_templates>
  <admin_template_modifications/>
  <code_events/>
  <code_event_listeners>
    <listener event_id="file_health_check" execute_order="10" callback_class="ThreemaGateway_Listener_FileHealthCheck" callback_method="fileHealthCheck" active="1" hint="" description="Integrate add-on into health check"/>
    <listener event_id="init_dependencies" execute_order="10" callback_class="ThreemaGateway_Listener_InitDependencies" callback_method="addHelpers" active="1" hint="" description="Extend init_dependencies for template helpers"/>
    <listener event_id="load_class_controller" execute_order="5" callback_class="ThreemaGateway_Listener_LoadClassController" callback_method="extendAccountController" active="1" hint="XenForo_ControllerPublic_Account" description="Extend XF account controller"/>
  </code_event_listeners>
  <cron/>
  <email_templates/>
  <email_template_modifications/>
  <optiongroups>
    <group group_id="threemagw" display_order="1" debug_only="0"/>
    <group group_id="threemagw_tfa" display_order="2" debug_only="0"/>
    <option option_id="threema_gateway_downloadpath" edit_format="textbox" data_type="string" can_backup="1" validation_class="ThreemaGateway_Option_DownloadPath" validation_method="verifyOption">
      <default_value>internal_data/threemagateway/recfiles</default_value>
      <edit_format_params>placeholder=internal_data/threemagateway/recfiles</edit_format_params>
      <sub_options></sub_options>
      <relation group_id="threemagw" display_order="180"/>
    </option>
    <option option_id="threema_gateway_e2e" edit_format="radio" data_type="string" can_backup="1">
      <default_value></default_value>
      <edit_format_params>basic={xen:phrase option_threema_gateway_mode_basic}
e2e={xen:phrase option_threema_gateway_mode_e2e}</edit_format_params>
      <sub_options></sub_options>
      <relation group_id="threemagw" display_order="120"/>
    </option>
    <option option_id="threema_gateway_httpshardening" edit_format="select" data_type="integer" can_backup="1">
      <default_value>1</default_value>
      <edit_format_params>0={xen:phrase option_threema_gateway_httpshardening_no}
1={xen:phrase option_threema_gateway_httpshardening_basic}
2={xen:phrase option_threema_gateway_httpshardening_enhanced}</edit_format_params>
      <sub_options></sub_options>
      <relation group_id="threemagw" display_order="240"/>
    </option>
    <option option_id="threema_gateway_keystorefile" edit_format="onofftextbox" data_type="array" can_backup="1" validation_class="ThreemaGateway_Option_PhpKeyStorePath" validation_method="verifyOption">
      <default_value>a:2:{s:7:"enabled";s:1:"0";s:4:"path";s:0:"";}</default_value>
      <edit_format_params>onoff=enabled
value=path
type=textbox
placeholder={xen:phrase threemagw_phpkeystore_example}</edit_format_params>
      <sub_options>enabled
path</sub_options>
      <relation group_id="threemagw" display_order="230"/>
    </option>
    <option option_id="threema_gateway_logreceivedmsgs" edit_format="callback" data_type="array" can_backup="1" validation_class="ThreemaGateway_Option_DebugModeLog" validation_method="verifyOption">
      <default_value>a:2:{s:7:"enabled";s:1:"0";s:4:"path";s:45:"internal_data/threemagateway/receivedmsgs.log";}</default_value>
      <edit_format_params>ThreemaGateway_Option_DebugModeLog::renderOption</edit_format_params>
      <sub_options>enabled
path</sub_options>
      <relation group_id="threemagw" display_order="380"/>
    </option>
    <option option_id="threema_gateway_privatekeyfile" edit_format="textbox" data_type="string" can_backup="1" validation_class="ThreemaGateway_Option_PrivateKeyPath" validation_method="verifyOption">
      <default_value></default_value>
      <edit_format_params>placeholder={xen:phrase threemagw_privatekeyfile_example}</edit_format_params>
      <sub_options></sub_options>
      <relation group_id="threemagw" display_order="130"/>
    </option>
    <option option_id="threema_gateway_receivecallback" edit_format="callback" data_type="string" can_backup="1" validation_class="ThreemaGateway_Option_ReceiveCallback" validation_method="verifyOption">
      <default_value></default_value>
      <edit_format_params>ThreemaGateway_Option_ReceiveCallback::renderOption</edit_format_params>
      <sub_options></sub_options>
      <relation group_id="threemagw" display_order="170"/>
    </option>
    <option option_id="threema_gateway_status" edit_format="callback" data_type="boolean" can_backup="1">
      <default_value>true</default_value>
      <edit_format_params>ThreemaGateway_Option_Status::renderHtml</edit_format_params>
      <sub_options></sub_options>
      <relation group_id="threemagw" display_order="1"/>
    </option>
    <option option_id="threema_gateway_tfa_autolookupmail" edit_format="onoff" data_type="boolean" can_backup="1">
      <default_value>1</default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="threemagw_tfa" display_order="40"/>
    </option>
    <option option_id="threema_gateway_tfa_autolookupphone" edit_format="onofftextbox" data_type="array" can_backup="1">
      <default_value>a:2:{s:7:"enabled";s:0:"";s:9:"userfield";s:0:"";}</default_value>
      <edit_format_params>onoff=enabled
value=userfield
type=textbox
placeholder=</edit_format_params>
      <sub_options>enabled
userfield</sub_options>
      <relation group_id="threemagw_tfa" display_order="45"/>
    </option>
    <option option_id="threema_gateway_tfa_conventional" edit_format="onoff" data_type="boolean" can_backup="1">
      <default_value>0</default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="threemagw_tfa" display_order="105"/>
    </option>
    <option option_id="threema_gateway_tfa_conventional_vadility" edit_format="spinbox" data_type="positive_integer" can_backup="1">
      <default_value>3</default_value>
      <edit_format_params>min=1</edit_format_params>
      <sub_options></sub_options>
      <relation group_id="threemagw_tfa" display_order="110"/>
    </option>
    <option option_id="threema_gateway_tfa_conventional_vadility_setup" edit_format="spinbox" data_type="positive_integer" can_backup="1">
      <default_value>10</default_value>
      <edit_format_params>min=1</edit_format_params>
      <sub_options></sub_options>
      <relation group_id="threemagw_tfa" display_order="115"/>
    </option>
    <option option_id="threema_gateway_tfa_useimprovedsrng" edit_format="onoff" data_type="boolean" can_backup="1">
      <default_value>1</default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="threemagw_tfa" display_order="25"/>
    </option>
    <option option_id="threema_gateway_threema_id" edit_format="textbox" data_type="string" can_backup="1" validation_class="ThreemaGateway_Option_ThreemaGatewayId" validation_method="verifyOption">
      <default_value></default_value>
      <edit_format_params>placeholder = *MYAPIID</edit_format_params>
      <sub_options></sub_options>
      <relation group_id="threemagw" display_order="110"/>
    </option>
    <option option_id="threema_gateway_threema_id_secret" edit_format="callback" data_type="string" can_backup="1" validation_class="ThreemaGateway_Option_ThreemaGatewaySecret" validation_method="verifyOption">
      <default_value></default_value>
      <edit_format_params>ThreemaGateway_Option_ThreemaGatewaySecret::renderOption</edit_format_params>
      <sub_options></sub_options>
      <relation group_id="threemagw" display_order="115"/>
    </option>
    <option option_id="threema_gateway_userfield_verifyexist" edit_format="onoff" data_type="boolean" can_backup="1">
      <default_value>0</default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="threemagw" display_order="310"/>
    </option>
    <option option_id="threema_gateway_usesource" edit_format="onoff" data_type="boolean" can_backup="1">
      <default_value>0</default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="threemagw" display_order="220"/>
    </option>
    <option option_id="threema_gateway_verify_receive_time" edit_format="onofftextbox" data_type="array" can_backup="1" validation_class="ThreemaGateway_Option_VerifyReceiveTime" validation_method="verifyOption">
      <default_value>a:2:{s:7:"enabled";s:1:"0";s:4:"time";s:0:"";}</default_value>
      <edit_format_params>onoff=enabled
value=time
type=textbox
placeholder=-14 days</edit_format_params>
      <sub_options>enabled
time</sub_options>
      <relation group_id="threemagw" display_order="330"/>
    </option>
  </optiongroups>
  <permissions>
    <permission_groups>
      <permission_group permission_group_id="threemagw"/>
    </permission_groups>
    <permissions>
      <permission permission_group_id="threemagw" permission_id="fetch" permission_type="flag" depend_permission_id="use" default_value="unset" interface_group_id="threemagw" display_order="20"/>
      <permission permission_group_id="threemagw" permission_id="lookup" permission_type="flag" depend_permission_id="use" default_value="unset" interface_group_id="threemagw" display_order="30"/>
      <permission permission_group_id="threemagw" permission_id="receive" permission_type="flag" depend_permission_id="use" default_value="unset" interface_group_id="threemagw" display_order="15"/>
      <permission permission_group_id="threemagw" permission_id="send" permission_type="flag" depend_permission_id="use" default_value="unset" interface_group_id="threemagw" display_order="10"/>
      <permission permission_group_id="threemagw" permission_id="tfa" permission_type="flag" depend_permission_id="use" default_value="unset" interface_group_id="threemagw" display_order="55"/>
      <permission permission_group_id="threemagw" permission_id="use" permission_type="flag" default_value="unset" interface_group_id="threemagw" display_order="5"/>
    </permissions>
    <interface_groups>
      <interface_group interface_group_id="threemagw" display_order="305"/>
    </interface_groups>
  </permissions>
  <phrases>
    <phrase title="admin_permission_threemagw_showcredits" version_id="1" version_string="0.1.0"><![CDATA[Threema Gateway: Show credits]]></phrase>
    <phrase title="option_group_threemagw" version_id="1" version_string="0.1"><![CDATA[Threema Gateway]]></phrase>
    <phrase title="option_group_threemagw_description" version_id="1" version_string="0.1.0"><![CDATA[Here you can configure the "core" settings of the <a href="https://gateway.threema.ch" target="_blank">Threema Gateway</a>.]]></phrase>
    <phrase title="option_group_threemagw_tfa" version_id="1" version_string="0.1.0"><![CDATA[Threema Gateway - Two-factor-authentication]]></phrase>
    <phrase title="option_group_threemagw_tfa_description" version_id="1" version_string="0.1.0"><![CDATA[Here you can configure the two-factor-authentication modes of the Threema Gateway. Please note that the general Threema Gateway settings must be configured before.]]></phrase>
    <phrase title="option_threema_gateway_downloadpath" version_id="1" version_string="0.1.0"><![CDATA[Download path for files]]></phrase>
    <phrase title="option_threema_gateway_downloadpath_explain" version_id="1" version_string="0.1.0"><![CDATA[This is the path where files send to your ID should be saved (in decrypted form!). When no path is given the files are not downloaded (not recommend!). The path must be relative to the XenForo root.]]></phrase>
    <phrase title="option_threema_gateway_e2e" version_id="1" version_string="0.1"><![CDATA[Operation mode]]></phrase>
    <phrase title="option_threema_gateway_e2e_explain" version_id="1" version_string="0.1.0"><![CDATA[Select the mode you chose when setting up your Threema ID. Without the end-to-end encrypted mode many options may not be available.]]></phrase>
    <phrase title="option_threema_gateway_httpshardening" version_id="1" version_string="0.1.0"><![CDATA[Hardened HTTPS connection (recommend)]]></phrase>
    <phrase title="option_threema_gateway_httpshardening_basic" version_id="1" version_string="0.1.0"><![CDATA[Basic hardening]]></phrase>
    <phrase title="option_threema_gateway_httpshardening_enhanced" version_id="1" version_string="0.1.0"><![CDATA[Enhanced hardening]]></phrase>
    <phrase title="option_threema_gateway_httpshardening_explain" version_id="1" version_string="0.1.0"><![CDATA[When sending messages this prevents fallback attacks on the TLS/HTTPS connection by limiting the TLS version and ciphers to modern ones.
You may try to set this as high as possible. If you experience problems connecting to the Threema server (e.g. when the credits are not fetched correctly) you know your limit.]]></phrase>
    <phrase title="option_threema_gateway_httpshardening_no" version_id="1" version_string="0.1.0"><![CDATA[No hardening]]></phrase>
    <phrase title="option_threema_gateway_keystorefile" version_id="1" version_string="0.1.0"><![CDATA[Use PHP Keystore (not recommend)]]></phrase>
    <phrase title="option_threema_gateway_keystorefile_explain" version_id="1" version_string="0.1.0"><![CDATA[By default the database is used to store the public keys of Threema users. When enabling this option you can specify a php file to use. This file <b>must already exist</b>!
Note that the file must be stored in <code>library/ThreemaGateway</code>, but you can use relative paths to change this location.]]></phrase>
    <phrase title="option_threema_gateway_logreceivedmsgs" version_id="1" version_string="0.1.0"><![CDATA[Log received messages (debug mode)]]></phrase>
    <phrase title="option_threema_gateway_logreceivedmsgs_explain" version_id="2" version_string="0.2.0"><![CDATA[When activated this logs all received messages to a path you specify. The path must be relative to the XenForo root.<br>
<b>Note:</b> Please only use this for temporarily for debugging purposes as it dumps secret information to disk to your disk.<br>
When the path is publicly accessible everyone can see every message!
For security reasons this setting <b>is ignored</b> when XenForo is not running in debug mode.]]></phrase>
    <phrase title="option_threema_gateway_mode_basic" version_id="1" version_string="0.1.0"><![CDATA[Basic mode]]></phrase>
    <phrase title="option_threema_gateway_mode_e2e" version_id="1" version_string="0.1.0"><![CDATA[End-to-end encrypted mode]]></phrase>
    <phrase title="option_threema_gateway_privatekeyfile" version_id="1" version_string="0.1.0"><![CDATA[Private key file]]></phrase>
    <phrase title="option_threema_gateway_privatekeyfile_explain" version_id="1" version_string="0.1.0"><![CDATA[If you use the end-to-end encrypted mode enter the path to your private key file here. The file must be placed in <code>library/ThreemaGateway</code>. You can however use relative paths to place it somewhere else.<br />
<a href="https://github.com/rugk/threema-msgapi-sdk-php/wiki/How-to-generate-a-new-key-pair-and-send-a-message#4-generate-a-keypair-by-running-the-tool" target="_blank">In the wiki</a> you can find an explanation how to do this. You can begin with step 4 as the msgapi tool is already included in <code>library/ThreemaGateway/threema-msgapi-sdk-php/threema-msgapi-tool.php</code>.]]></phrase>
    <phrase title="option_threema_gateway_receivecallback" version_id="1" version_string="0.1.0"><![CDATA[Callback for Threema Gateway server]]></phrase>
    <phrase title="option_threema_gateway_receivecallback_explain" version_id="1" version_string="0.1.0"><![CDATA[Here you can find your callback URL for the Threema Gateway server, which you need for receiving messages. The access token you can change here should be a random string.
It has been randomly generated at the installation of this add-on. You can regenerate it by leaving this field empty.]]></phrase>
    <phrase title="option_threema_gateway_status" version_id="1" version_string="0.1"><![CDATA[Status]]></phrase>
    <phrase title="option_threema_gateway_status_credits" version_id="1" version_string="0.1"><![CDATA[Remaining credits: <b>{credits}</b>]]></phrase>
    <phrase title="option_threema_gateway_status_credits_error" version_id="1" version_string="0.1.0"><![CDATA[There was an error when fetching credits. You probably have entered an incorrect Threema Gateway ID or secret. There could also have been a connection error.]]></phrase>
    <phrase title="option_threema_gateway_status_credits_low" version_id="1" version_string="0.1"><![CDATA[Your credits are getting low. Please consider recharging them.]]></phrase>
    <phrase title="option_threema_gateway_status_credits_out" version_id="1" version_string="0.1"><![CDATA[You have no credits (anymore). Without any credits you cannot send messages any more.]]></phrase>
    <phrase title="option_threema_gateway_status_credits_permission" version_id="1" version_string="0.1.0"><![CDATA[You are not allowed to view the remaining credits.]]></phrase>
    <phrase title="option_threema_gateway_status_credits_recharge" version_id="1" version_string="0.1.0"><![CDATA[(<a href="https://gateway.threema.ch/en/load" target="_blank">recharge</a>)]]></phrase>
    <phrase title="option_threema_gateway_status_custom_gwserver_error" version_id="1" version_string="0.1.0"><![CDATA[Gateway Server error: ]]></phrase>
    <phrase title="option_threema_gateway_status_custom_phpsdk_error" version_id="1" version_string="0.1.0"><![CDATA[Error in PHP-SDK: ]]></phrase>
    <phrase title="option_threema_gateway_status_debug_mode_active" version_id="1" version_string="0.1.0"><![CDATA[The debug mode is currently enabled, which means some or all messages are logged into a text file! You should <a href="#_threema_gateway_logreceivedmsgs">disable this below</a> after you finished debugging.]]></phrase>
    <phrase title="option_threema_gateway_status_debug_mode_potentially_active" version_id="1" version_string="0.1.0"><![CDATA[The debug mode of this add-on is currently enabled, which means some or all messages may be logged when you enable XenForo's debug mode! If this is not intentional, please <a href="#_threema_gateway_logreceivedmsgs">disable this mode below</a>.]]></phrase>
    <phrase title="option_threema_gateway_status_error" version_id="1" version_string="0.1"><![CDATA[You have some errors in your configuration. Until you resolve them it will not be possible to use this addon properly.]]></phrase>
    <phrase title="option_threema_gateway_status_explain" version_id="1" version_string="0.1"><![CDATA[]]></phrase>
    <phrase title="option_threema_gateway_status_libsodiumphp_outdated" version_id="1" version_string="0.1.0"><![CDATA[This version is outdated. It is strongly recommend to upgrade to a newer version of libsodium-php (at least v1.0.1).]]></phrase>
    <phrase title="option_threema_gateway_status_libsodiumphp_version" version_id="1" version_string="0.1.0"><![CDATA[<a href="https://github.com/jedisct1/libsodium-php" target="_blank">Sodium-PHP</a> version: <b>{version}</b>]]></phrase>
    <phrase title="option_threema_gateway_status_libsodium_not_installed" version_id="1" version_string="0.1"><![CDATA[Libsodium is not installed.]]></phrase>
    <phrase title="option_threema_gateway_status_libsodium_not_installed_recommend" version_id="1" version_string="0.1.0"><![CDATA[For performance and security reasons it is very much recommend to install <a href="https://download.libsodium.org/doc/" target="_blank">libsodium</a> and the <a href="https://github.com/jedisct1/libsodium-php" target="_blank">php extension</a>. You can follow <a href="https://paragonie.com/book/pecl-libsodium/read/00-intro.md#installing-libsodium" target="_blank">this guide</a> for doing so.<br />
Additionally many 2FA methods will be disabled if you do not install libsodium.]]></phrase>
    <phrase title="option_threema_gateway_status_libsodium_not_installed_required_64bit" version_id="1" version_string="0.1.0"><![CDATA[You can only use the pure PHP implementation with a 64bit version of PHP, so you either have to install PHP x64 or <a href="https://paragonie.com/book/pecl-libsodium/read/00-intro.md#installing-libsodium" target="_blank">install libsodium</a>, which also provides more speed and security advantages.]]></phrase>
    <phrase title="option_threema_gateway_status_libsodium_outdated" version_id="1" version_string="0.1"><![CDATA[This version is outdated. It is strongly recommend to upgrade to a newer version of libsodium.]]></phrase>
    <phrase title="option_threema_gateway_status_libsodium_version" version_id="1" version_string="0.1.0"><![CDATA[<a href="https://download.libsodium.org/doc/" target="_blank">Sodium</a> version: <b>{version}</b>]]></phrase>
    <phrase title="option_threema_gateway_status_missing_private_key" version_id="1" version_string="0.1.0"><![CDATA[Currently it is not possible to use the Threema Gateway, because the private key is malformed or not specified.]]></phrase>
    <phrase title="option_threema_gateway_status_no_https" version_id="1" version_string="0.1.0"><![CDATA[You do not use HTTPS. Without HTTPS not only the secrets you enter here are unprotected, but also some settings and 2FA methods may not be available. Especially you will not be able to receive messages as Threema requires HTTPS for their callback.]]></phrase>
    <phrase title="option_threema_gateway_status_phpsdk_featurelevel" version_id="1" version_string="0.1.0"><![CDATA[(feature level: <b>{level}</b>)]]></phrase>
    <phrase title="option_threema_gateway_status_phpsdk_not_ready" version_id="1" version_string="0.1.0"><![CDATA[The PHP-SDK is not ready and cannot be used. You may need to check your setup.]]></phrase>
    <phrase title="option_threema_gateway_status_phpsdk_not_ready_yet" version_id="1" version_string="0.1.0"><![CDATA[The PHP-SDK is not ready yet and cannot be used. You may need to setup it first.]]></phrase>
    <phrase title="option_threema_gateway_status_phpsdk_version" version_id="1" version_string="0.1.0"><![CDATA[Version of <a href="https://github.com/rugk/threema-msgapi-sdk-php" target="_blank">Threema PHP SDK</a>: <b>{version}</b>]]></phrase>
    <phrase title="option_threema_gateway_tfa_autolookupmail" version_id="1" version_string="0.1.0"><![CDATA[Automatically lookup mail addresses]]></phrase>
    <phrase title="option_threema_gateway_tfa_autolookupmail_explain" version_id="1" version_string="0.1.0"><![CDATA[When the user activates a 2FA mode this option automatically tries to get the Threema ID associated with the mail address of the user. The mail address is hashed before it is send to the Threema server.]]></phrase>
    <phrase title="option_threema_gateway_tfa_autolookupphone" version_id="1" version_string="0.1.0"><![CDATA[Automatically lookup phone numbers]]></phrase>
    <phrase title="option_threema_gateway_tfa_autolookupphone_explain" version_id="1" version_string="0.1.0"><![CDATA[When the user activates a 2FA mode this option automatically tries to get the Threema ID associated with the mobile phone number of the user. The phone number is hashed before it is send to the Threema server.<br />
Add the ID of the custom user field in the input box, where it should be looked for phone numbers.<br />
<b>Important:</b> When the phone number in this custom user field is not verified when it is saved this allows forum users to lookup arbitrary phone number of any Threema user.]]></phrase>
    <phrase title="option_threema_gateway_tfa_conventional" version_id="1" version_string="0.1.0"><![CDATA[Activate Threema Gateway: Conventional]]></phrase>
    <phrase title="option_threema_gateway_tfa_conventional_explain" version_id="1" version_string="0.1.0"><![CDATA[Allow users to use the "Conventional" 2FA method.]]></phrase>
    <phrase title="option_threema_gateway_tfa_conventional_vadility" version_id="1" version_string="0.1.0"><![CDATA[Vadility time]]></phrase>
    <phrase title="option_threema_gateway_tfa_conventional_vadility_explain" version_id="1" version_string="0.1.0"><![CDATA[How long the one time code should be valid. (in minutes)]]></phrase>
    <phrase title="option_threema_gateway_tfa_conventional_vadility_setup" version_id="1" version_string="0.1.0"><![CDATA[Vadility time when setting up]]></phrase>
    <phrase title="option_threema_gateway_tfa_conventional_vadility_setup_explain" version_id="1" version_string="0.1.0"><![CDATA[How long the one time code should be valid when setting up the 2FA method. (in minutes)<br>
It is useful that this value is a bit higher than the previous one, to give the user more time to read through the explanations or similar things. The first setup is assumed to take a bit longer.]]></phrase>
    <phrase title="option_threema_gateway_tfa_useimprovedsrng" version_id="1" version_string="0.1.0"><![CDATA[Use libsodiums random number generator instead of XenForo's internal one (recommend)]]></phrase>
    <phrase title="option_threema_gateway_tfa_useimprovedsrng_explain" version_id="1" version_string="0.1.0"><![CDATA[When this setting is activated all 2FA methods try to use <a href="https://download.libsodium.org/doc/generating_random_data/index.html" target="_blank">libsodium's random number generator</a> instead of XenForo's internal one. This may provide better security.]]></phrase>
    <phrase title="option_threema_gateway_threema_id" version_id="1" version_string="0.1.0"><![CDATA[Threema Gateway ID]]></phrase>
    <phrase title="option_threema_gateway_threema_id_explain" version_id="1" version_string="0.1"><![CDATA[Enter the Threema ID of your Gateway account here. (e.g. <code>*MYAPIID</code>)]]></phrase>
    <phrase title="option_threema_gateway_threema_id_secret" version_id="1" version_string="0.1"><![CDATA[Threema ID secret]]></phrase>
    <phrase title="option_threema_gateway_threema_id_secret_explain" version_id="1" version_string="0.1.0"><![CDATA[Enter your secret for accessing the Threema Gateway here.{note}]]></phrase>
    <phrase title="option_threema_gateway_threema_id_secret_explain_note" version_id="1" version_string="0.1.0"><![CDATA[<br >
<b>Note:</b> For security reasons your secret is mostly hidden and will only be changed when you replace the value here.]]></phrase>
    <phrase title="option_threema_gateway_userfield_verifyexist" version_id="1" version_string="0.1.0"><![CDATA[Verify existence of Threema IDs entered in custom user fields]]></phrase>
    <phrase title="option_threema_gateway_userfield_verifyexist_explain" version_id="1" version_string="0.1.0"><![CDATA[When this option is deactivated only the format of the Threema ID is verified. If it is activated the Threema server is also queried to check whether the ID really exists.]]></phrase>
    <phrase title="option_threema_gateway_usesource" version_id="1" version_string="0.1.0"><![CDATA[Use source code of PHP SDK]]></phrase>
    <phrase title="option_threema_gateway_usesource_explain" version_id="1" version_string="0.1.0"><![CDATA[Instead of using the .phar file this forces the add-on to use the source code of the PHP SDK. This is in most cases only useful for debugging.]]></phrase>
    <phrase title="option_threema_gateway_verify_receive_time" version_id="2" version_string="0.2.0"><![CDATA[Reject old messages when receiving]]></phrase>
    <phrase title="option_threema_gateway_verify_receive_time_explain" version_id="2" version_string="0.2.0"><![CDATA[When activated, this verifies the time, when messages are received, so old messages are rejected. The format of the date must be a valid one, which can be processed by <a href="https://secure.php.net/manual/function.strtotime.php" target="_blank"><code>strtotime</code></a>. The date must be a <a href="https://secure.php.net/manual/datetime.formats.relative.php" target="_blank">relative one</a>.
A recommend value is 20 minutes (<code>-20 min</code>) as the Gateway server retries sending a message for a maximum of 15 minutes.
<br>
When disabled a hardcoded fallback to 14 days (<code>-14 days</code>) is used, as messages can never be older than 14 days as they are deleted from the Gateway server.]]></phrase>
    <phrase title="permission_group_threemagw" version_id="1" version_string="0.1.0"><![CDATA[Threema Gateway]]></phrase>
    <phrase title="permission_interface_threemagw" version_id="1" version_string="0.1.0"><![CDATA[Threema Gateway]]></phrase>
    <phrase title="permission_threemagw_fetch" version_id="1" version_string="0.1.0"><![CDATA[Fetch public key (based on ID)]]></phrase>
    <phrase title="permission_threemagw_lookup" version_id="1" version_string="0.1.0"><![CDATA[Lookup ID/public key based on any criteria]]></phrase>
    <phrase title="permission_threemagw_receive" version_id="1" version_string="0.1.0"><![CDATA[Receive messages]]></phrase>
    <phrase title="permission_threemagw_send" version_id="1" version_string="0.1.0"><![CDATA[Send messages]]></phrase>
    <phrase title="permission_threemagw_tfa" version_id="1" version_string="0.1.0"><![CDATA[Use Threema 2FA]]></phrase>
    <phrase title="permission_threemagw_use" version_id="1" version_string="0.1.0"><![CDATA[Use Threema Gateway]]></phrase>
    <phrase title="sendto_threema" version_id="1" version_string="0.1"><![CDATA[Send to Threema]]></phrase>
    <phrase title="tfa_threemagw_conventional" version_id="1" version_string="0.1.0"><![CDATA[Threema - Conventional]]></phrase>
    <phrase title="tfa_threemagw_conventional_desc" version_id="1" version_string="0.1.0"><![CDATA[This will send you a 6 digit code through Threema to verify your login.{e2e}]]></phrase>
    <phrase title="tfa_threemagw_conventional_message" version_id="1" version_string="0.1.0"><![CDATA[\ud83d\udd11 Two-factor authentication

Hi {user},
to complete the second step of the two-factor authentication, you must enter the following code:

{code}

The code is valid for {vadilityTime}.

The login was requested via the IP {ip}. If you did not initiate this request, you should change your password urgently.

Thanks,
{board}
{board_url}]]></phrase>
    <phrase title="tfa_threemagw_conventional_message_has_been_send_to_x_with_code_continue" version_id="1" version_string="0.1"><![CDATA[A Threema message has been sent to <b>{threemaid}</b> with a single-use code. Please enter that code to continue.]]></phrase>
    <phrase title="tfa_threemagw_conventional_message_has_been_send_to_x_with_code_login" version_id="1" version_string="0.1"><![CDATA[A Threema message has been sent to <b>{threemaid}</b> with a single-use code. Please enter that code to complete login.]]></phrase>
    <phrase title="tfa_threemagw_conventional_message_short" version_id="1" version_string="0.1"><![CDATA[\ud83d\udd11
Code: {code}
IP: {ip}
Validity: {vadilityTime}

{board}
{board_url}]]></phrase>
    <phrase title="tfa_threemagw_conventional_setup_descr" version_id="1" version_string="0.1"><![CDATA[This mode sends you a 6 digit code to your Threema ID, which you have to enter when logging in.]]></phrase>
    <phrase title="tfa_threemagw_setup_generaldescr" version_id="1" version_string="0.1"><![CDATA[This two factor authentication mode uses the <a href="https://threema.ch" target="_blank">Threema</a> app. Before you can proceed you have to download it. It is available <a href="https://threema.ch/get-threema" target="_blank">for many platforms</a>. <br />
Setup your Threema ID and enter it below.]]></phrase>
    <phrase title="tfa_threemagw_setup_public_key" version_id="1" version_string="0.1"><![CDATA[Public Key]]></phrase>
    <phrase title="tfa_threemagw_setup_public_key_descr" version_id="1" version_string="0.1"><![CDATA[Before proceeding, please confirm that the following fingerprint is correct. Often you can find it on the same page where you can also see your Threema ID and QR code.<br>
<b>Key fingerprint:</b> {pubKeyShort}<br /><br />
Please check each character of the code and confirm it is the same as displayed on your device. Should you notice any discrepancy when doing so, please <i>do not continue</i> and contact the forum admin.<br />
The displayed fingerprint is derived from the public key, which is linked to your Threema ID. More information <a href="https://threema.ch/en/faq/threema_id" target="_blank">in the Threema FAQ</a>.]]></phrase>
    <phrase title="tfa_threemagw_short_message_explain" version_id="1" version_string="0.1"><![CDATA[Uses short messages instead of long ones to allow you to see your verification code directly in the notification, so you do not have to open Threema to see it.]]></phrase>
    <phrase title="tfa_threemagw_use_number_smilies" version_id="1" version_string="0.1"><![CDATA[Use smilies as digits]]></phrase>
    <phrase title="tfa_threemagw_use_number_smilies_explain" version_id="1" version_string="0.1"><![CDATA[Replaces the numbers in the code with smilies.]]></phrase>
    <phrase title="tfa_threemagw_use_short_message" version_id="1" version_string="0.1"><![CDATA[Use short messages]]></phrase>
    <phrase title="threemagw_confirmation_code" version_id="1" version_string="0.1"><![CDATA[Threema Confirmation Code]]></phrase>
    <phrase title="threemagw_fetching_publickey_failed" version_id="1" version_string="0.1.0"><![CDATA[Fetching public key failed.]]></phrase>
    <phrase title="threemagw_getting_credits_failed" version_id="1" version_string="0.1.0"><![CDATA[Getting credits failed.]]></phrase>
    <phrase title="threemagw_invalid_debuglogpath" version_id="1" version_string="0.1.0"><![CDATA[The path of the message debug log file is invalid. Please check your permissions.]]></phrase>
    <phrase title="threemagw_invalid_discard_old_date" version_id="2" version_string="0.2.0"><![CDATA[The date given for discarding old messages is invalid.]]></phrase>
    <phrase title="threemagw_invalid_downloadpath" version_id="1" version_string="0.1.0"><![CDATA[The directory cannot be used. Please check the directory and it's permissions.]]></phrase>
    <phrase title="threemagw_invalid_httpshardening_option" version_id="1" version_string="0.1.0"><![CDATA[The HTTPS hardening option is invalid.]]></phrase>
    <phrase title="threemagw_invalid_keystorepath" version_id="1" version_string="0.1.0"><![CDATA[The path to the PHP keystore file is invalid.]]></phrase>
    <phrase title="threemagw_invalid_privatekey" version_id="1" version_string="0.1.0"><![CDATA[The private key is invalid or could not be found.]]></phrase>
    <phrase title="threemagw_invalid_privkeypath" version_id="1" version_string="0.1.0"><![CDATA[The path to the private key file is invalid.]]></phrase>
    <phrase title="threemagw_invalid_threema_id" version_id="1" version_string="0.1"><![CDATA[The Threema ID is invalid.]]></phrase>
    <phrase title="threemagw_invalid_threema_secret" version_id="1" version_string="0.1.0"><![CDATA[The Threema ID Secret is invalid.]]></phrase>
    <phrase title="threemagw_libsodium_error" version_id="1" version_string="0.1.0"><![CDATA[Error when trying to use libsodium.]]></phrase>
    <phrase title="threemagw_message_is_sent_e2e" version_id="1" version_string="0.1.0"><![CDATA[The message is sent end-to-end encrypted.]]></phrase>
    <phrase title="threemagw_minute" version_id="1" version_string="0.1"><![CDATA[minute]]></phrase>
    <phrase title="threemagw_minutes" version_id="1" version_string="0.1"><![CDATA[minutes]]></phrase>
    <phrase title="threemagw_missing_e2e_helper" version_id="1" version_string="0.1.0"><![CDATA[The E2E helper is missing. Probably it was tried to use it although the Gateway is not used in E2E mode.]]></phrase>
    <phrase title="threemagw_missing_sdk" version_id="1" version_string="0.1.0"><![CDATA[The PHP SDK for Threema Gateway is missing.]]></phrase>
    <phrase title="threemagw_not_writable_keystorefile" version_id="1" version_string="0.1.0"><![CDATA[The PHP keystore file is not writable.]]></phrase>
    <phrase title="threemagw_permission_error" version_id="1" version_string="0.1.0"><![CDATA[There was a permission error.]]></phrase>
    <phrase title="threemagw_phpkeystore_example" version_id="1" version_string="0.1.0"><![CDATA[keystore.php]]></phrase>
    <phrase title="threemagw_privatekeyfile_example" version_id="1" version_string="0.1.0"><![CDATA[privateKey.txt]]></phrase>
    <phrase title="threemagw_sending_failed" version_id="1" version_string="0.1.0"><![CDATA[Sending message failed.]]></phrase>
    <phrase title="threemagw_threemaid" version_id="1" version_string="0.1.0"><![CDATA[Threema ID]]></phrase>
    <phrase title="threemagw_threema_id_does_not_exist" version_id="1" version_string="0.1"><![CDATA[Threema ID does not exist.]]></phrase>
    <phrase title="user_field_threemaid" global_cache="1" version_id="1" version_string="0.1.0"><![CDATA[Threema ID]]></phrase>
    <phrase title="user_field_threemaid_desc" version_id="1" version_string="0.1.0"><![CDATA[]]></phrase>
  </phrases>
  <route_prefixes/>
  <style_properties/>
  <templates>
    <template title="account_two_step_threemagw_conventional_manage" version_id="1" version_string="0.1.0"><![CDATA[<xen:title>{xen:phrase two_step_verification_setup}: {$provider.title}</xen:title>

<xen:require css="threemagw.css" />
<form method="post" class="xenForm {xen:if $newProviderHtml, AutoValidator}"
<xen:comment>Use /enable link when setting provider up and use /manage link when changing setting later.</xen:comment>
action=<xen:if is="{$context} == 'firstsetup' or {$context} == 'setupvalidation'">
		"{xen:link 'account/two-step/enable'}"
	<xen:else />
		"{xen:link 'account/two-step/manage'}"
	</xen:if> data-redirect="yes">
	<dl class="ctrlUnit">
		<dt></dt>
		<xen:if is="{$context} == 'firstsetup'">
			<xen:comment>First site of setup page shows general information.</xen:comment>
			<dd>
				<p>{xen:phrase tfa_threemagw_setup_generaldescr}</p>
				<p>{xen:phrase tfa_threemagw_conventional_setup_descr}</p>
			</dd>
		<xen:elseif is="{$context} == 'manage'" />
			<xen:comment>Later manages only show some basic information...</xen:comment>
			<dd>
                <p>{xen:phrase tfa_threemagw_conventional_setup_descr}</p>
			</dd>
		</xen:if>
	</dl>

	<xen:if is="{$newProviderHtml}">
		<xen:comment>Shows validation input field if Threema ID was changed.</xen:comment>
		{xen:raw $newProviderHtml}

		<dl class="ctrlUnit submitUnit">
			<dt></dt>
			<dd><input type="submit" name="save" value="{xen:phrase confirm}" accesskey="s" class="button primary" /></dd>
		</dl>

		<input type="hidden" name="confirm" value="1" />
	<xen:else />
		<xen:comment>Show Threema ID input and all other settings as this is not the validation page.</xen:comment>
		<dl class="ctrlUnit">
            <dt><label for="ctrl_threemagw_conventional_threemaid">{xen:phrase threemagw_threemaid}:</label></dt>
			<dd>
				<input class="textCtrl inputThreemaId" type="text" name="threemaid" id="ctrl_threemagw_conventional_threemaid" placeholder="ECHOECHO" required="" maxlength="8" class="textCtrl" pattern="{xen:helper threemaregex, 'personal'}" value="{$threemaId}" />
			</dd>

			<xen:if is="{$context} == 'manage'">
				<dt><label></label></dt>
				<dd>
					<p><b>Key fingerprint:</b> {xen:helper threemaidpubkeyshort, {$threemaid}}<br /><br /></p>
				</dd>
			</xen:if>
		</dl>

		<dl class="ctrlUnit">
			<dt><label>{xen:phrase more_options}:</label></dt>
			<dd><ul>
				<li>
					<label><input type="checkbox" name="useNumberSmilies" value="1" {xen:if $providerData.useNumberSmilies, 'checked=""'} /> {xen:phrase tfa_threemagw_use_number_smilies}</label>
                    <p class="explain">{xen:phrase tfa_threemagw_use_number_smilies_explain}</p>
				</li>
			</ul></dd>

			<dt></dt>
			<dd><ul>
				<li>
					<label><input type="checkbox" name="useShortMessage" value="1" {xen:if $providerData.useShortMessage, 'checked=""'} /> {xen:phrase tfa_threemagw_use_short_message}</label>
					<p class="explain">{xen:phrase tfa_threemagw_short_message_explain}</p>
				</li>
			</ul></dd>
		</dl>

		<dl class="ctrlUnit submitUnit">
			<dt></dt>
			<xen:if is="{$context} == 'firstsetup'">
				<dd><input type="submit" name="save" value="{xen:phrase confirm}" accesskey="s" class="button primary" /></dd>
			<xen:elseif is="{$context} == 'setup'" />
				<dd><input type="submit" name="save" value="{xen:phrase save}" accesskey="s" class="button primary" /></dd>
			<xen:else />
				<dd><input type="submit" name="save" value="{xen:phrase sendto_threema}" accesskey="s" class="button primary" /></dd>
			</xen:if>
		</dl>
	</xen:if>

	<input type="hidden" name="provider" value="{$providerId}" />
	<xen:if is="{$context} == 'firstsetup' or {$context} == 'setupvalidation'">
		<xen:comment>Add special parameters if this is in setup.</xen:comment>
		<xen:if is="{$newProviderHtml}">
			<input type="hidden" name="step" value="confirm" />
		<xen:else />
			<input type="hidden" name="step" value="setup" />
		</xen:if>
	<xen:elseif is="!{$newProviderHtml}" />
		<input type="hidden" name="manage" value="1" />
	</xen:if>
	<input type="hidden" name="_xfConfirm" value="1" />
	<input type="hidden" name="_xfToken" value="{$visitor.csrf_token_page}" />
</form>]]></template>
    <template title="threemagw.css" version_id="1" version_string="0.1"><![CDATA[.inputThreemaId {
  text-transform: uppercase;
}]]></template>
    <template title="two_step_threemagw_conventional" version_id="1" version_string="0.1.0"><![CDATA[<xen:if is="{$context} == 'setup'">
	<dl class="ctrlUnit">
		<dt></dt>
		<dd>
            <p>{xen:phrase tfa_threemagw_conventional_message_has_been_send_to_x_with_code_continue, 'threemaid={$data.threemaid}'}</p>
		</dd>
	</dl>
<xen:else />
    <p>{xen:phrase tfa_threemagw_conventional_message_has_been_send_to_x_with_code_login, 'threemaid={$data.threemaid}'}</p>
</xen:if>

<dl class="ctrlUnit">
    <dt><label for="ctrl_threemagw_code">{xen:phrase threemagw_confirmation_code}:</label></dt>
	<dd>
        <input type="text" name="code" id="ctrl_threemagw_code" class="textCtrl" />
	</dd>
</dl>

<xen:if is="{$context} == 'setup'">
	<xen:comment>Show public key of Threema ID</xen:comment>
	<xen:comment>This allows the user to verify the public key received by the server, so potential Man-in-the-middle attacks can be mitigated.</xen:comment>
	<dl class="ctrlUnit">
		<dt><label>{xen:phrase tfa_threemagw_setup_public_key}:</label></dt>
		<dd>
			<p>{xen:phrase tfa_threemagw_setup_public_key_descr, 'threemaid={$data.threemaid}', 'pubKeyShort={xen:helper threemaidpubkeyshort, {$data.threemaid}}'}</p>
		</dd>
	</dl>
</xen:if>]]></template>
  </templates>
  <public_template_modifications/>
  <bb_code_media_sites/>
  <bb_codes/>
</addon>
